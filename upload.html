<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="homecss.css">
  <link rel="stylesheet" href="stylesheet.css">

  <title>Button Test</title>

</head>

<body>
  <div class="display">
    <div id="title-block">
      <h1 class="title">QM HabitApp</h1>
    </div>
    <p id="welcome">Upload Your Images!</p>
    <button id="btn-info">Info</button>
    <div id="modal">
      <div id="modal-content">
        <div id="modal-header">
          <span class="close">&times;</span>
          <h2 id="info">How to use</h2>
        </div>
        <div id="modal-body">
          <p id="text">Press the button below to upload the pictures you have taken!</p>
          <p id="text">Pressing delete to remove all of you uploaded images.</p>
        </div>
      </div>
    </div>
    <button id="B1" class="btn-delete" onclick="deleteImage()">Delete Image</button>
  <form action="" id="form">
    <label for="imgUpload">*Image:</label>
    <input type="file" id="imgUpload" name="imgUpload" accept="image/jpeg, image/png, image/jpg, image/heic" required>
    <output></output>
    
    
    <br>
    <br>
    <label for="title">*Title:</label>
    <input type="text" id="title" name="title" required><br><br>
    <label for="descrip">Description:</label>
    <input type="text" id="descrip" name="descrip"><br><br>
    <input type="submit" id="btn-submit" value="Submit">
    <input type="button" id="b1" value="Delete">
  </form>
  <p id="txt-map">Press below you want to see the current map </p>
  <div class="button" id="btn-map" onclick="location.href = 'map.html'">
    <svg id='map-svg' xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 42 42" fill="none">
      <a href="map.html">
        <path d="M0 0H42V42H0V0Z" fill="white" fill-opacity="0.01" />
        <path
          d="M3.5 5.25L4.23336 3.66107C3.69149 3.41098 3.05953 3.45428 2.55683 3.77592C2.05413 4.09756 1.75 4.65321 1.75 5.25H3.5ZM3.5 31.5H1.75C1.75 32.1826 2.14688 32.8029 2.76665 33.0889L3.5 31.5ZM14.875 36.75L14.1417 38.3389C14.6836 38.589 15.3155 38.5458 15.8182 38.2241C16.3209 37.9025 16.625 37.3468 16.625 36.75H14.875ZM14.875 10.5H16.625C16.625 9.81742 16.2281 9.19713 15.6083 8.91109L14.875 10.5ZM2.76665 33.0889L14.1417 38.3389L15.6083 35.1611L4.23336 29.9111L2.76665 33.0889ZM15.6083 8.91109L4.23336 3.66107L2.76665 6.83893L14.1417 12.0889L15.6083 8.91109ZM13.125 10.5V36.75H16.625V10.5H13.125ZM5.25 31.5V5.25H1.75V31.5H5.25Z"
          fill="#F5F6F6" />
        <path
          d="M14.875 36.75H13.125C13.125 37.3383 13.4206 37.8872 13.9116 38.211C14.4028 38.5348 15.0237 38.5902 15.5643 38.3585L14.875 36.75ZM27.125 31.5L27.8143 33.1085C28.4578 32.8327 28.875 32.2001 28.875 31.5H27.125ZM27.125 5.25001H28.875C28.875 4.66175 28.5794 4.11287 28.0884 3.78904C27.5972 3.46521 26.9763 3.40978 26.4357 3.6415L27.125 5.25001ZM14.875 10.5L14.1857 8.89149C13.5422 9.16729 13.125 9.79992 13.125 10.5H14.875ZM15.5643 38.3585L27.8143 33.1085L26.4357 29.8915L14.1857 35.1415L15.5643 38.3585ZM26.4357 3.6415L14.1857 8.89149L15.5643 12.1085L27.8143 6.85851L26.4357 3.6415ZM28.875 31.5V5.25001H25.375V31.5H28.875ZM13.125 10.5V36.75H16.625V10.5H13.125Z"
          fill="#F5F6F6" />
        <path
          d="M27.125 31.5H25.375C25.375 32.1826 25.7719 32.8029 26.3917 33.0889L27.125 31.5ZM38.5 36.75L37.7667 38.3389C38.3086 38.589 38.9405 38.5458 39.4432 38.2241C39.9459 37.9025 40.25 37.3468 40.25 36.75H38.5ZM38.5 10.5H40.25C40.25 9.81742 39.8531 9.19713 39.2333 8.91109L38.5 10.5ZM27.125 5.25L27.8583 3.66107C27.3165 3.41098 26.6845 3.45428 26.1818 3.77592C25.6792 4.09756 25.375 4.65321 25.375 5.25H27.125ZM26.3917 33.0889L37.7667 38.3389L39.2333 35.1611L27.8583 29.9111L26.3917 33.0889ZM39.2333 8.91109L27.8583 3.66107L26.3917 6.83893L37.7667 12.0889L39.2333 8.91109ZM36.75 10.5V36.75H40.25V10.5H36.75ZM28.875 31.5V5.25H25.375V31.5H28.875Z"
          fill="#F5F6F6" />
      </a>
    </svg>
  </div>
  </div>
</body>
<!-- <script src="exif.min.js"></script> -->
<script src="exif.js"></script>
<script src="script.js"></script>
<script>
  var modal = document.getElementById("modal");
  var btn = document.getElementById("btn-info");
  var span = document.getElementsByClassName("close")[0];
  btn.onclick = function () {
    modal.style.display = "block";
  }
  // When the user clicks on <span> (x), close the modal
  span.onclick = function () {
    modal.style.display = "none";
  }
  window.onclick = function (event) {
    if (event.target == modal) {
      modal.style.display = "none";
    }
  } 

  
</script>
<script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.18.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.18.0/firebase-analytics.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
  const firebaseConfig = {
    apiKey: "AIzaSyA_kojUp7JbkEhVopquwm1iEZ726dbpnNA",
    authDomain: "qm-habitapp.firebaseapp.com",
    databaseURL: "https://qm-habitapp-default-rtdb.firebaseio.com",
    projectId: "qm-habitapp",
    storageBucket: "qm-habitapp.appspot.com",
    messagingSenderId: "560401229086",
    appId: "1:560401229086:web:4217b16f9678ffd811d50f",
    measurementId: "G-LL3PSHXV7Z"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
  //const storage = getStorage(app);
  
  import {getDatabase, ref, get, set, child, update, remove, push}
  from "https://www.gstatic.com/firebasejs/9.18.0/firebase-database.js";

  import { getStorage, ref as sRef, uploadBytes, getDownloadURL } 
  from "https://www.gstatic.com/firebasejs/9.18.0/firebase-storage.js";

  const db = getDatabase();

  const storage = getStorage();
  const storageRef = sRef(storage, "uploads");

  //var locationUploaded = document.getElementById("imgStar");

  var form = document.getElementById('form');
  form.addEventListener('submit', function(event) {
    event.preventDefault();
    // Check if all required fields have a value
    var requiredFields = document.querySelectorAll('[required]');
    var filledFields = 0;
    requiredFields.forEach(function(field) {
      if (field.value) {
        filledFields++;
      }
    });
    if (filledFields !== requiredFields.length) {
      // If not all required fields are filled, prevent form submission
      alert('Please fill in all required fields.');
    }
    else
    {
      UploadData();

      document.getElementById("imgUpload").hidden = false;
    }
    
  });

  function UploadData(){
    var title = document.getElementById("title");
    console.log(title.value);
    var description = document.getElementById("descrip");
    var pic = document.getElementById("imgStar").src;
    var dateTaken = document.getElementById("DT");
    var dateUploaded = document.getElementById("DU");
    var timeTaken = document.getElementById("TT");
    var timeUploaded = document.getElementById("TU");
    var locationTaken = document.getElementById("LT");

    const input = document.querySelector("input");
    const file = input.files[0];

    const fileName = Math.random().toString(36).substring(2) + Date.now().toString() + '.' + input.files[0].name.split('.').pop()
    const metadata = {
      contentType: file.type
    };
    const imageRef = sRef(storageRef, fileName);

    uploadBytes(imageRef, file, metadata)
      .then(() => {
        console.log("Image uploaded successfully!");
        return getDownloadURL(imageRef);
      })     
    .then((url) => {
      console.log("Getting Image URL");
      console.log("Image URL: ", url);
      console.log(title.value);
      // Store the URL in your Realtime Database or Firestore document
      //Do FireBase Database here...
      const dataRef = ref(db, "data");

      const newDataRef = push(dataRef, {
        // Title: title.value,
        // Description: description.value,
       
      });

      set(newDataRef, {
        Title: title.value,
        Description: description.value,
        ImageURL: url,
        DateTaken: dateTaken.innerHTML,
        DateUploaded: dateUploaded.innerHTML,
        TimeTaken: timeTaken.innerHTML,
        TimeUploaded: timeUploaded.innerHTML,
        LocationTaken: locationTaken.innerHTML,
      }).then(() => {
        console.log("New data added!");
        location.reload();
      }).catch((error) => {
        console.error("Error adding new user: ", error);
      }); 
    })
    .catch((error) => {
      console.error("Error getting image URL: ", error);
    });


   
  }

  

//   function storageFire(){
//      // Get the file
//      var file = document.getElementById('imgUpload').files[0];

// // Create a new unique file name for the image
// var fileName = Math.random().toString(36).substring(2) + Date.now().toString() + '.' + file.name.split('.').pop();

// // Upload the file to Firebase Storage
// var uploadTask = storage.child('images/' + fileName).put(file);

// // Monitor the upload progress
// uploadTask.on('state_changed', function(snapshot){
//   // Show the upload progress
//   var progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
//   console.log('Upload is ' + progress + '% done');
// }, function(error) {
//   // Handle upload error
//   console.log(error);
// }, function() {
//   // Handle successful upload
//   console.log('File uploaded successfully');
  
//   // Get the download URL for the file
//   uploadTask.snapshot.ref.getDownloadURL().then(function(downloadURL) {
//     // Save the download URL to Firebase Realtime Database
//     db.push({ url: downloadURL });
//     console.log('Download URL saved to database');
//   });
// });
//   }
</script>

</html>

<!-- <body>
    <div class="display">
        <div id="title-block">
            <h1 class="title">QM HabitApp</h1>
        </div>
        <p id="welcome">Upload Your Pictures!</p>

        <form action="">
            <p id="text">Press the button below to upload the pictures you have taken!</p>
            <p id="text">If you make a mistake, press delete to remove all of you uploaded images.</p>
            <br>
            <label for="imgUpload">Image:</label>
            <input type="file" id="imgUpload" name="imgUpload" accept="image/jpeg, image/png, image/jpg, image/heic">
            <output></output>
            <button class='button' id="btn-delete" onclick="B1()">Delete</button>
            <pre>Make and model: <span id="makeAndModel"></span></pre>
            <br>
            <label for="title">Title:</label>
            <input type="text" id="title" name="title"><br><br>
            <label for="descrip">Description:</label>
            <input type="text" id="descrip" name="descrip"><br><br>
            <input type="submit" class='button' id="btn-submit" onclick="uploadEntry()" value="Submit">
        </form>
        <p id="txt-map">Press below you want to see the current map </p>
        <div class="button" id="btn-map" onclick="location.href = 'map.html'">
            <svg id='map-svg' xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 42 42" fill="none">
                <a href="map.html">
                    <path d="M0 0H42V42H0V0Z" fill="white" fill-opacity="0.01" />
                    <path
                        d="M3.5 5.25L4.23336 3.66107C3.69149 3.41098 3.05953 3.45428 2.55683 3.77592C2.05413 4.09756 1.75 4.65321 1.75 5.25H3.5ZM3.5 31.5H1.75C1.75 32.1826 2.14688 32.8029 2.76665 33.0889L3.5 31.5ZM14.875 36.75L14.1417 38.3389C14.6836 38.589 15.3155 38.5458 15.8182 38.2241C16.3209 37.9025 16.625 37.3468 16.625 36.75H14.875ZM14.875 10.5H16.625C16.625 9.81742 16.2281 9.19713 15.6083 8.91109L14.875 10.5ZM2.76665 33.0889L14.1417 38.3389L15.6083 35.1611L4.23336 29.9111L2.76665 33.0889ZM15.6083 8.91109L4.23336 3.66107L2.76665 6.83893L14.1417 12.0889L15.6083 8.91109ZM13.125 10.5V36.75H16.625V10.5H13.125ZM5.25 31.5V5.25H1.75V31.5H5.25Z"
                        fill="#F5F6F6" />
                    <path
                        d="M14.875 36.75H13.125C13.125 37.3383 13.4206 37.8872 13.9116 38.211C14.4028 38.5348 15.0237 38.5902 15.5643 38.3585L14.875 36.75ZM27.125 31.5L27.8143 33.1085C28.4578 32.8327 28.875 32.2001 28.875 31.5H27.125ZM27.125 5.25001H28.875C28.875 4.66175 28.5794 4.11287 28.0884 3.78904C27.5972 3.46521 26.9763 3.40978 26.4357 3.6415L27.125 5.25001ZM14.875 10.5L14.1857 8.89149C13.5422 9.16729 13.125 9.79992 13.125 10.5H14.875ZM15.5643 38.3585L27.8143 33.1085L26.4357 29.8915L14.1857 35.1415L15.5643 38.3585ZM26.4357 3.6415L14.1857 8.89149L15.5643 12.1085L27.8143 6.85851L26.4357 3.6415ZM28.875 31.5V5.25001H25.375V31.5H28.875ZM13.125 10.5V36.75H16.625V10.5H13.125Z"
                        fill="#F5F6F6" />
                    <path
                        d="M27.125 31.5H25.375C25.375 32.1826 25.7719 32.8029 26.3917 33.0889L27.125 31.5ZM38.5 36.75L37.7667 38.3389C38.3086 38.589 38.9405 38.5458 39.4432 38.2241C39.9459 37.9025 40.25 37.3468 40.25 36.75H38.5ZM38.5 10.5H40.25C40.25 9.81742 39.8531 9.19713 39.2333 8.91109L38.5 10.5ZM27.125 5.25L27.8583 3.66107C27.3165 3.41098 26.6845 3.45428 26.1818 3.77592C25.6792 4.09756 25.375 4.65321 25.375 5.25H27.125ZM26.3917 33.0889L37.7667 38.3389L39.2333 35.1611L27.8583 29.9111L26.3917 33.0889ZM39.2333 8.91109L27.8583 3.66107L26.3917 6.83893L37.7667 12.0889L39.2333 8.91109ZM36.75 10.5V36.75H40.25V10.5H36.75ZM28.875 31.5V5.25H25.375V31.5H28.875Z"
                        fill="#F5F6F6" />
                </a>
            </svg>
        </div>
    </div>
</body>

</html> -->