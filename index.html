<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Interactive Map</title>
    <link rel="stylesheet" href="maptest.css" />
    <link rel="stylesheet" href="stylesheet.css" />

    <style></style>
  </head>
  <body>
      <div id="title-block">
        <img src="img/Text wo BG.png" alt="logo" id="logo" style="margin-top:-0.5vh ;">
      </div>
<div id="counter">
  <p>What lives here?</p>
  <p>3 species... and counting!</p>
</div>
<button class="button" id="btn-popup">
  <p>What this means...</p>
</button>
  <div id="modal">
    <div id="modal-content">
      <div id="modal-header">
        <span class="close">&times;</span>
        <h2 id="info">Our Aims</h2>
      </div>
      <div id="modal-body">
        <p id="text">We are facing some serious environmental challenges. 
          One of the biggest is loss of biodiversity. Few people are aware of the value and richness of the greenspaces around them. 
        </p><p>HabitApp's goal is to get people in and appreciating our urban greenspaces- maybe convert a few to bona fide citizen scientists.</p>
        <p><b>Our 3-part mission:</b></p>
        <p id="text"><b>1.	Habitat Restoration:</b><br> When people are aware of the importance of these areas for biodiversity, they might just be more likely to participate in restoration efforts. At Queen Mary we have wildflower planting and canal clean-ups you can sign up for on the Student Union site.</p>
        <p id="text"><b>2.	Ecological Education:</b><br> Increased awareness of urban greenspaces can help people understand the value of biodiversity and the role that greenspaces play in supporting ecological processes such as pollination, nutrient cycling, and carbon sequestration.</p>
        <p id="text"><b>3.	Citizen Science:</b><br> By crowdsourcing this data we can make a rich and valuable monitor of species population and how they may be affected by climate and…us! In a time of changing climate this is more important than ever before. We share all out data with iNaturalist so it can be used by ecology researchers across the globe.</p>
      </div>
    </div>
  </div>
    <div id="map">
      <div id="container"></div>
    </div>
    <button class="button" id="btn-popup2"  onclick=" location.href = 'data.html'">
      <p>What you have seen!</p>
    </button>
      <div id="modal2">
        <div id="modal-content2">
          <div id="modal-header2">
            <span class="close2">&times;</span>
            <h2 id="info">Black Poplars</h2>
          </div>
          <img src="img/Black Poplar.jpg" alt="raretreeswoooo" id="modal-img">
          <div id="modal-body2">
            <p>It is estimated that only around 7,000 wild black poplars now grow in the entirety of Britain and of these, only 600 are female trees.</p><p> With so few left, natural pollination is unlikely, and the species could soon become extinct without a concerted effort to protect them.</p>
          </div>
        </div>
      </div>
      <div id="modal3">
        <div id="modal-content2">
          <div id="modal-header2">
            <span class="close3">&times;</span>
            <h2 id="info">Hedgehog</h2>
          </div>
            <img src="img/hedgehog.jpg" alt="hedgehogboi" id="modal-img">
          <div id="modal-body2">
            <p>Hedgehogs are in decline across Britain. By one estimate, urban populations have dropped by 30% since 2000.</p>
            <p>According to London Wildlife Trust, numbers have plummeted from 30 million to less than 1 million since the 1950s.</p>
            <p>Mile End park is home to a small population- we are really lucky to have a photo captured because these guys are nocturnal creatures.</p>
          </div>
        </div>
      </div>
    <button class="button" id="upload" onclick=" location.href = 'upload.html'">
      <!-- <a href="upload.html"> -->
      <svg id="upload-svg" xmlns="http://www.w3.org/2000/svg" width="83.253" height="72.684" fill-rule="evenodd" clip-rule="evenodd" image-rendering="optimizeQuality" shape-rendering="geometricPrecision" text-rendering="geometricPrecision" viewBox="0 0 2191.85 1913.6" id="camera"><path fill-rule="nonzero" d="M1630.73 229.46l164.86 0c109.04,0 208.13,44.58 279.91,116.35 71.77,71.77 116.35,170.89 116.35,279.9l0 891.63c0,109.04 -44.57,208.13 -116.34,279.9 -71.77,71.78 -170.88,116.36 -279.92,116.36l-1399.34 0c-109.04,0 -208.13,-44.58 -279.9,-116.36 -71.78,-71.77 -116.36,-170.86 -116.36,-279.9l0 -891.63c0,-109.04 44.58,-208.14 116.36,-279.91 71.77,-71.78 170.86,-116.34 279.9,-116.34l164.87 0c15.58,-50.48 46.02,-94.89 83.46,-130.79 63.66,-61.08 151.05,-98.67 218.71,-98.67l465.25 0c67.66,0 155.06,37.59 218.71,98.67 37.43,35.9 67.87,80.31 83.47,130.79zm-534.81 359.12c133.33,0 254.1,54.07 341.49,141.46 87.4,87.4 141.47,208.16 141.47,341.5 0,133.33 -54.07,254.09 -141.47,341.49 -87.41,87.39 -208.14,141.46 -341.49,141.46 -133.35,0 -254.08,-54.07 -341.49,-141.46 -87.39,-87.41 -141.46,-208.15 -141.46,-341.49 0,-133.35 54.07,-254.09 141.46,-341.5 87.39,-87.39 208.16,-141.46 341.49,-141.46zm236.44 246.52c-60.49,-60.49 -144.09,-97.9 -236.44,-97.9 -92.34,0 -175.95,37.41 -236.44,97.9 -60.47,60.49 -97.9,144.1 -97.9,236.44 0,92.33 37.43,175.95 97.9,236.43 60.49,60.48 144.1,97.91 236.44,97.91 92.33,0 175.95,-37.43 236.44,-97.91 60.49,-60.48 97.9,-144.09 97.9,-236.43 0,-92.35 -37.41,-175.95 -97.9,-236.44zm463.23 -457.03l-227.87 0c-41.03,0 -74.3,-33.27 -74.3,-74.3 0,-36.68 -20.59,-71.15 -48.91,-98.3 -36.67,-35.19 -82.85,-56.85 -115.96,-56.85l-465.25 0c-33.11,0 -79.29,21.66 -115.96,56.85 -28.32,27.16 -48.91,61.62 -48.91,98.3 0,41.03 -33.27,74.3 -74.3,74.3l-227.87 0c-68.04,0 -129.95,27.89 -174.85,72.79 -44.9,44.91 -72.8,106.82 -72.8,174.86l0 891.63c0,68.02 27.9,129.95 72.8,174.85 44.91,44.9 106.82,72.8 174.85,72.8l1399.34 0c68.04,0 129.97,-27.9 174.86,-72.8 44.91,-44.91 72.79,-106.81 72.79,-174.85l0 -891.63c0,-68.02 -27.89,-129.95 -72.8,-174.84 -44.91,-44.91 -106.82,-72.81 -174.85,-72.81z"/>
      </svg>
      <p>Get Started!</p>
    </a>
    </button>
    <div id="slideshow-container">
      <div id="slide-content">
        <div class="slide fade">
          <div class="numbertext">1 / 2</div>
          <img id="slide-img1" src="img/Black Poplar.jpg">
          <div class="img-text">
            <p><b>QM - Home to some of the rarest trees in Britain </b></p>
            <p>Stop by the Novo Cemetary to see them</p>
            <p style="color: blue;">Press the image to read more</p>
          </div>
        </div>
        <div class="slide fade">
          <div class="numbertext">2 / 2</div>
          <img id="slide-img2" src="img/hedgehog.jpg">
          <div class="img-text">
            <b><p>Spotted! Hedgehog spotted in Mile End Park</b></p>
            <p>Our top spot of the week goes to the (not so) common hedgehog.</p>
            <p style="color: blue;">Press the image to read more</p>
          </div>
        </div>
      </div>
      <button class="prev" onclick="plusSlides(-1)">&#10094;</button>
      <button class="next" onclick="plusSlides(1)">&#10095;</button>
      <div style="text-align:center">
        <span class="dot" onclick="currentSlide(1)"></span>
        <span class="dot" onclick="currentSlide(2)"></span>
        <!-- <span class="dot"></span> -->
      </div>
    </div>
</div>
  </body>
  <script>
    var modal2 = document.getElementById("modal2");
    var modal3 = document.getElementById("modal3");

    var img1 = document.getElementById("slide-img1");
    var img2 = document.getElementById("slide-img2");
    var span = document.getElementsByClassName("close2")[0];
    var span3 = document.getElementsByClassName("close3")[0];
    img1.onclick = function () {
      modal2.style.display = "block";
    }
    img2.onclick = function () {
      modal3.style.display = "block";
    }
    // When the user clicks on <span> (x), close the modal
    span.onclick = function () {
      modal2.style.display = "none";
    }
    span3.onclick = function () {
      modal3.style.display = "none";
    }
    window.onclick = function (event) {
      if (event.target == modal2) {
        modal2.style.display = "none";
      }
    } 
    window.onclick = function (event) {
      if (event.target == modal3) {
        modal3.style.display = "none";
      }
    } 
  </script>
  <script>
    var modal = document.getElementById("modal");
    var btn = document.getElementById("btn-popup");
    var span = document.getElementsByClassName("close")[0];
    btn.onclick = function () {
      modal.style.display = "block";
    }
    // When the user clicks on <span> (x), close the modal
    span.onclick = function () {
      modal.style.display = "none";
    }
    window.onclick = function (event) {
      if (event.target == modal) {
        modal.style.display = "none";
      }
    } 
  </script>
  <script>
    var slideIndex = 0;
    showSlides();
    var slides, dots;
  
    function showSlides() {
      var i;
      slides = document.getElementsByClassName("slide");
      dots = document.getElementsByClassName("dot");
      for (i = 0; i < slides.length; i++) {
        slides[i].style.display = "none";
      }
      slideIndex++;
      if (slideIndex > slides.length) { slideIndex = 1 }
      for (i = 0; i < dots.length; i++) {
        dots[i].className = dots[i].className.replace(" active", "");
      }
      slides[slideIndex - 1].style.display = "block";
      dots[slideIndex - 1].className += " active";
      setTimeout(showSlides, 4000); // Change image every 4 seconds
    }
  
    function plusSlides(position) {
      slideIndex += position;
      if (slideIndex > slides.length) { slideIndex = 1 }
      else if (slideIndex < 1) { slideIndex = slides.length }
      for (i = 0; i < slides.length; i++) {
        slides[i].style.display = "none";
      }
      for (i = 0; i < dots.length; i++) {
        dots[i].className = dots[i].className.replace(" active", "");
      }
      slides[slideIndex - 1].style.display = "block";
      dots[slideIndex - 1].className += " active";
    }
  
    function currentSlide(index) {
      if (index > slides.length) { index = 1 }
      else if (index < 1) { index = slides.length }
      for (i = 0; i < slides.length; i++) {
        slides[i].style.display = "none";
      }
      for (i = 0; i < dots.length; i++) {
        dots[i].className = dots[i].className.replace(" active", "");
      }
      slides[index - 1].style.display = "block";
      dots[index - 1].className += " active";
    }
  </script>
  <script type="module">
    import * as THREE from "./node_modules/three/build/three.module.js";
    import { OBJLoader } from "../node_modules/three/examples/jsm/loaders/OBJLoader.js";
    import { OrbitControls } from "../node_modules/three/examples/jsm/controls/OrbitControls.js";

    const container = document.getElementById("container");

    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(
      75,
      container.clientWidth / container.clientHeight,
      0.1,
      1000
    );
    const renderer = new THREE.WebGLRenderer();
    renderer.setSize(container.clientWidth, container.clientHeight);
    container.appendChild(renderer.domElement);

    const controls = new OrbitControls(camera, renderer.domElement);

    //Gradient Background
    const canvas = document.createElement("canvas");
    canvas.width = 256;
    canvas.height = 256;
    const context = canvas.getContext("2d");
    const gradient = context.createLinearGradient(0, 0, 0, canvas.height);
    gradient.addColorStop(0, "#cfd9df");
    gradient.addColorStop(1, "#e2ebf0");
    context.fillStyle = gradient;
    context.fillRect(0, 0, canvas.width, canvas.height);
    const texture = new THREE.CanvasTexture(canvas);
    scene.background = texture;

    //Lighting
    const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
    directionalLight.position.set(0, 10, 0);
    scene.add(directionalLight);

    directionalLight.castShadow = true;

    directionalLight.shadow.mapSize.width = 2048;
    directionalLight.shadow.mapSize.height = 2048;
    directionalLight.shadow.camera.near = 0.5;
    directionalLight.shadow.camera.far = 500;

    directionalLight.shadow.cameraVisible = true;
    directionalLight.shadow.bias = 0.001;

    // Load the OBJ file
    const loader = new OBJLoader();
    const textureLoader = new THREE.TextureLoader();
    loader.load("qm campus.obj", function (obj) {
      obj.scale.set(10, 10, 10); // Scale the object

      const boundingBox = new THREE.Box3().setFromObject(obj); // Compute bounding box
      const center = new THREE.Vector3();
      boundingBox.getCenter(center); // Get center of bounding box

      obj.position.sub(center);
      console.log(center); // Shift object to center at origin

      // Create a pivot point
      const pivot = new THREE.Object3D();
      pivot.position.copy(center);
      scene.add(pivot);
      pivot.add(obj); // Add the object to the pivot point

      obj.traverse((child) => {
        if (child instanceof THREE.Mesh) {
          const texture = textureLoader.load("textures/Solid_grey.svg.png");
          child.material = new THREE.MeshPhongMaterial({ map: texture });
          child.castShadow = true; // Enable casting of shadows by this mesh
          child.receiveShadow = true; // Enable receiving of shadows by this mesh
        }
      });
    });

    camera.position.z = 5;

    function animate() {
      requestAnimationFrame(animate);
      // // Rotate the object
      // scene.children.forEach(child => {
      //     if(child instanceof THREE.Object3D){
      //       child.rotation.x += 0.00;
      //       child.rotation.y += 0.001;
      //     }
      //     });
      renderer.render(scene, camera);
    }
    animate();

    // function createAMarker()
    // {
    //     // Create a new mesh object for the marker
    //     const markerGeometry = new THREE.SphereGeometry(0.1, 32, 32);
    //     const markerMaterial = new THREE.MeshBasicMaterial({ color: 0xff0000 });
    //     const markerMesh = new THREE.Mesh(markerGeometry, markerMaterial);

    //     // Position the marker in the scene
    //     markerMesh.position.set(0, 0, 0);
    //     scene.add(markerMesh);

    //     // Add a click event listener to the marker
    //     markerMesh.addEventListener('click', () => {
    //     // Perform the desired action when the marker is clicked
    //     console.log('Marker clicked!');
    //     });
    // }

    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.18.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.18.0/firebase-analytics.js";
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries

    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
      apiKey: "AIzaSyA_kojUp7JbkEhVopquwm1iEZ726dbpnNA",
      authDomain: "qm-habitapp.firebaseapp.com",
      databaseURL: "https://qm-habitapp-default-rtdb.firebaseio.com",
      projectId: "qm-habitapp",
      storageBucket: "qm-habitapp.appspot.com",
      messagingSenderId: "560401229086",
      appId: "1:560401229086:web:4217b16f9678ffd811d50f",
      measurementId: "G-LL3PSHXV7Z",
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);

    import {
      getDatabase,
      ref,
      get,
      set,
      child,
      update,
      remove,
      push,
      onValue,
    } from "https://www.gstatic.com/firebasejs/9.18.0/firebase-database.js";

    import {
      getStorage,
      ref as sRef,
      uploadBytes,
      getDownloadURL,
    } from "https://www.gstatic.com/firebasejs/9.18.0/firebase-storage.js";

    const db = getDatabase();

    const storage = getStorage();
    const storageRef = sRef(storage, "uploads");

    // Get a reference to the "data" folder in your Firebase Realtime Database
    var dataRef = ref(db, "data");

    const images = document.createElement("div");
    images.setAttribute("id", "my-images"); //AA

    document.body.appendChild(images);
    // Loop through each unique key in the "data" folder and access the individual variables
    onValue(dataRef, (snapshot) => {
      snapshot.forEach((childSnapshot) => {
        const key = childSnapshot.key;
        const category = childSnapshot.child("Category").val();
        const location = childSnapshot.child("LocationTaken").val();
        const [lat, lng] = location.split(",");
        const dateTaken = childSnapshot.child("DateTaken").val();
        const dateUploaded = childSnapshot.child("DateUploaded").val();
        const timeTaken = childSnapshot.child("TimeTaken").val();
        const timeUploaded = childSnapshot.child("TimeUploaded").val();
        const title = childSnapshot.child("Title").val();
        const description = childSnapshot.child("Description").val();

        createAMarker(category, 0.75, lat, lng);

        //Add images
        const imageUrl = childSnapshot.child("ImageURL").val();

        // Create a new img element
        const img = document.createElement("img");

        img.setAttribute("id", "display-img");

        // Set the src attribute of the img element to the image URL
        img.src = imageUrl;

        // Add the img element to the document
        images.appendChild(img);

        //Text
        for (let i = 0; i < 8; i++) {
          let text;
          let heading;

          switch (i) {
            case 0:
              heading = "h1";

              text = title;
              break;

            case 1:
              heading = "h2";

              text = category;
              break;

            case 2:
              heading = "h3";
              text = description;
              break;

            case 3:
              heading = "h4";
              text = "Date Taken: " + dateTaken;
              break;

            case 4:
              heading = "h5";
              text = "Time Taken: " + timeTaken;
              break;

            case 5:
              heading = "h6";
              text = "Date Uploaded: " + dateUploaded;
              break;

            case 6:
              heading = "h7";
              text = "Time Uploaded: " + timeUploaded;
              break;

            case 7:
              heading = "h8";
              text = "Location: " + location;
              break;
          }
          // const newP = document.createElement("p");
          // newP.textContent = `${text}`;
          const newElement = document.createElement(heading);
          newElement.textContent = `${text}`;
          images.appendChild(newElement);

          // images.appendChild(newP);
          /// p was done by Nat to make paragraphs for each set of metadata. So i Made them headings instead so i can style them individullay. maybe theres a more efficient way though
        }
        // Adding space between images
        const hr = document.createElement("hr");
        images.appendChild(hr);
        images.appendChild(document.createElement("br"));
      });
    });

    function createAMarker(category, size, latitude, longitude) {
      let color;
      switch (category) {
        case "Animal":
          color = 0x46a937;
          break;

        case "Plant":
          color = 0xd1d123;
          break;

        case "Other":
          color = 0x4de9aa;
          break;

        default:
          color = 0xffffff;
          break;
      }
      var yCord = (latitude - 51.52212253745709) / 0.005590374772;
      var xCord = (longitude - -0.039975680525528745) / 0.004583935236;

      //Create a new mesh object for the marker
      const markerGeometry = new THREE.SphereGeometry(0.1, 32, 32);
      const markerMaterial = new THREE.MeshBasicMaterial({ color: color });
      const markerMesh = new THREE.Mesh(markerGeometry, markerMaterial);

      // Position the marker in the scene
      markerMesh.position.set(0 + 2 * xCord, -0.05, 4 - 4 * yCord);
      console.log(markerMesh.position);
      console.log(yCord);
      markerMesh.scale.set(size, size, size);
      scene.add(markerMesh);

      // Add a click event listener to the marker
      markerMesh.addEventListener("click", () => {
        // Perform the desired action when the marker is clicked
        console.log("Marker clicked!");
      });
    }
  </script>
</html>
